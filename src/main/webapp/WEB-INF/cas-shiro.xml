<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xmlns:p="http://www.springframework.org/schema/p"
	xmlns:util="http://www.springframework.org/schema/util" 
	xsi:schemaLocation="http://www.springframework.org/schema/beans  
	http://www.springframework.org/schema/beans/spring-beans-2.5.xsd 
	http://www.springframework.org/schema/util  
     http://www.springframework.org/schema/util/spring-util-3.0.xsd  ">
	
	<bean
    name="authenticationFilter"
    class="org.jasig.cas.client.authentication.AuthenticationFilter"
    p:casServerLoginUrl="https://localhost:8444/cas4/login"
    p:renew="false"
    p:gateway="false"
    p:service="http://localhost:8083/sso-test/secure/index.jsp" >
    </bean>
 
 <bean
    name="ticketValidationFilter"
    class="org.jasig.cas.client.validation.Cas20ProxyReceivingTicketValidationFilter"
    p:service="http://localhost:8083/sso-test/secure/index.jsp">
    <property name="ticketValidator">
        <bean class="org.jasig.cas.client.validation.Cas20ServiceTicketValidator">
            <constructor-arg index="0" value="https://localhost:8444/cas4" />
        </bean>
    </property>
</bean>

<bean id="shiroFilter" class="org.apache.shiro.spring.web.ShiroFilterFactoryBean">  
    <property name="securityManager" ref="securityManager"/>  
    <!-- 设定角色的登录链接，这里为cas登录页面的链接可配置回调地址  -->  
    <property name="loginUrl" value="https://localhost:8444/cas4/login?service=http://localhost:8083/sso-test/" />  
      
    <property name="filters">  
        <util:map>  
            <!-- 添加casFilter到shiroFilter -->  
            <entry key="casFilter" value-ref="casFilter"/>  
        </util:map>  
    </property>   
    <property name="filterChainDefinitions">  
        <value>                 
            /shiro-cas = casFilter  
            /admin/** = roles[ROLE_USER]
            /** = anon  
        </value>  
    </property>  
</bean>  
  
<bean id="casFilter" class="org.apache.shiro.cas.CasFilter">  
    <!-- 配置验证错误时的失败页面  -->  
    <property name="failureUrl" value="/error.jsp"/>  
</bean>  
  
<bean id="casRealm" class="org.apache.shiro.cas.CasRealm">  
    <property name="defaultRoles" value="ROLE_USER"/>       
    <property name="casServerUrlPrefix" value="https://localhost:8444"/>  
    <!-- 客户端的回调地址设置，必须和下面的shiro-cas过滤器拦截的地址一致 -->  
    <property name="casService" value="http://localhost:8083/sso-test/"/>  
</bean>  
  
<bean id="securityManager" class="org.apache.shiro.web.mgt.DefaultWebSecurityManager">      
    <property name="realm" ref="casRealm"/>  
    <property name="subjectFactory" ref="casSubjectFactory"/>  
</bean>  
  
<!-- 如果要实现cas的remember me的功能，需要用到下面这个bean，并设置到securityManager的subjectFactory中 -->  
<bean id="casSubjectFactory" class="org.apache.shiro.cas.CasSubjectFactory"/>  

  
<bean id="lifecycleBeanPostProcessor" class="org.apache.shiro.spring.LifecycleBeanPostProcessor"/>  

<bean class="org.springframework.beans.factory.config.MethodInvokingFactoryBean">  
    <property name="staticMethod" value="org.apache.shiro.SecurityUtils.setSecurityManager"/>  
    <property name="arguments" ref="securityManager"/>  
</bean> 

</beans>